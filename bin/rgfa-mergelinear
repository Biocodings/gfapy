#!/usr/bin/env ruby
require "rgfatools"

redundant = ARGV.delete("-r")
if ARGV.size != 1
  STDERR.puts "Usage: #$0 [-r] <gfa>"
  STDERR.puts "-r: redundant output of junctions (default: false)"
  exit 1
end

gfa = RGFA.new
#gfa.enable_progress_logging(part: 0.01)
gfa.vlevel = 0
gfa.read_file(ARGV[0])
if redundant
  # remove isolated segments, as this mode is for comparison
  # with readjoiner contigs, and isolated vertices are not output by readjoiner
  gfa.connected_components.each do |cc|
    if cc.size == 1
      gfa.segment(cc[0]).disconnect
    end
  end
end
gfa.merge_linear_paths(redundant: redundant,
                       disable_tracking: true)
#                       merged_name: :short)
puts gfa

